## CAS

某些 Atomic 类，在执行某项计算时不使用互斥，但在更新时会先把旧值和新值一起提交进行判断（`compareAndSwap()`），如果旧值不一致则更新失败，说明已经在其他地方被修改了。

### CAS 的原子性

CAS 是硬件级别的，在 Java 中是 native 方法。虽然它有读取、比较、写入操作，但 CAS 在大多数 CPU 中其实是一条命令（CMPXCHG 命令），而不是多条命令，所以是具有原子性的。对于不支持 CMPXCHG 的 CPU ，会进行加锁来保证不会被打断。

JAVA多线程里面CAS中比较和更新怎么保证同步？：https://www.zhihu.com/question/64915964/answer/225710737

Java Concurrency代码实例之三原子变量：https://zhuanlan.zhihu.com/p/27338395

​    

## ABA 问题

原值为 A ，当线程 1 和线程 2 分别进行 A->B ，B->A 的操作时，B->A 本该不能修改（修改前原值 A ，与预期原值不一样），但有可能线程 1 刚好结束了，使得线程 2 在比较时通过而修改成功。

为了避免 ABA 问题，CAS 在比较时不仅比较值，也要比较版本号（改完版本号进行加一）。