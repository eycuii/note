# 第7章 保证Web安全的HTTPS

​    

## HTTP 的缺点

使用明文（不加密），可能会被**窃听**；

不验证通信方的身份，可能遭遇**伪装**；

无法证明报文的完整性，可能被**篡改**；

### 通信使用明文可能会被窃听

**通信的加密**

HTTP 没有加密机制，但可以通过和 **SSL**（Secure Socket Layer，安全套接层）或 TLS（Transport Layer Security，安全层传输协议）的组合使用，加密 HTTP 的通信内容。

用 SSL 建立安全通信线路之后，就可以在这条线路上进行 HTTP 通信了。与 SSL 组合使用的 HTTP 被称为 **HTTPS**（HTTP Secure，超文本传输安全协议）或 HTTP over SSL。

**内容的加密**

对 HTTP 报文进行加密处理后再发送请求。服务器需要解密。缺点：仍有被篡改的风险。

### 不验证通信方的身份就可能遭遇伪装

HTTP 不会确认对方是否为指定的服务器 / 客户端。

**查明对手的证书**

SSL 使用了一种被称为证书的手段，可用于确定方。

证书由值得信任的第三方机构颁发，用以证明服务器和客户端是实际存在的。另外，伪造证书从技术角度来说是异常困难的一件事。所以只要能够确认通信方（服务器或客户端）持有的证书，即可判断通信方的真实意图。

客户端在开始通信之前会先确认服务器的证书。

### 无法证明报文完整性，可能已遭篡改

​    

## HTTP + 加密 + 认证 + 完整性保护 = HTTPS

### HTTPS 是身披 SSL 外壳的 HTTP

HTTPS 并非是应用层的一种新协议。只是 HTTP 通信接口部分用 SSL（Secure Socket Layer）和 TLS（Transport Layer Security）协议代 替而已。

通常，HTTP 直接和 TCP 通信。而当使用 SSL 时，会先和 SSL 通信，再由 SSL 和 TCP 通信。

SSL 是独立于 HTTP 的协议，所以不光是 HTTP 协议，其他运行在应 用层的 SMTP 和 Telnet 等协议均可配合 SSL协议使用。

### 相互交换密钥的公开密钥加密技术

SSL采用一种叫做**公开密钥加密**（Public-key cryptography）的加密处理方式。

近代的加密方法中加密算法是公开的，而密钥却是保密的。通过这种方式得以保持加密方法的安全性。

加密和解密都会用到密钥。没有密钥就无法对密码解密，反过来说，任何人只要持有密钥就能解密了。如果密钥被攻击者获得，那加密也就失去了意义。

#### 共享密钥加密的困境

加密和解密同用一个密钥的方式称为**共享密钥加密**（Common key crypto system），也被叫做**对称密钥加密**。

但存在密钥发送的问题：发送密钥有被窃听的风险，但不发送，对方就不能解密。然而，密钥如果能安全发送，那数据也应该能安全送达。

#### 使用两把密钥的公开密钥加密

公开密钥加密使用一对**非对称**的密钥：**私有密钥** （private key）、**公开密钥**（public key）。

私有密钥不能让其他任何人知道，公开密钥可以随意发布，任何人都可以获得。

**过程**：发送方使用对方的公钥进行加密，接收方用自己的私钥进行解密。

想根据密文和公开密钥，恢复到信息原文是异常困难的，因为解密过程就是在对离散对数进行求值，这并非轻而易举就能办到。退一步讲，如果能对一个非常大的整数做到快速地因式分解，那么密码破解还是存在希望的。但就目前的技术来看是不太现实的。

#### HTTPS 采用混合加密机制

HTTPS 采用共享密钥加密和公开密钥加密两者并用的混合加密机制。 

若密钥能够实现安全交换，那么有可能会考虑仅使用公开密钥加密来通信。因为公开密钥加密与共享密钥加密相比，其处理速度要慢。

所以，在交换密钥环节使用公开密钥加密方式，之后的建立通信交换报文阶段则使用共享密钥加密方式。

### 证明公开密钥正确性的证书

公开密钥加密方式还是存在一些问题：无法证明公开密钥本身就是货真价实的公开密钥。比如，正准备和某台服务器建立公开密钥加密方式下的通信时，如何证明收到的公开密钥就是原本预想的那台服务器发行的公开密钥。或许在公开密钥传输途中，真正的公开密钥已经被攻击者替换掉了。

为了解决上述问题， 可以使用由数字证书认证机构（CA，Certificate Authority） 和其相关机关颁发的**公开密钥证书**，也可叫做数字证书或直接称为证书。

流程：

服务器用自己的公钥登录到认证机构。认证机构用自己的私钥对服务器的公钥署数字签名，并颁发证书。

服务器发送证书后，客户端用认证机构的公钥（为了安全，多数浏览器开发商发布版本时，会事先在内部植入常用认证机关的公钥），对证书上的数字签名进行验证，一旦验证通过，客户端便可明确两件事：一，认证服务器公钥的是真实有效的认证机构。二，服务器的公钥是值得信赖的。

### 用以确认客户端的客户端证书

HTTPS 中还可以使用客户端证书。以客户端证书进行客户端认证，证明服务器正在通信的对方始终是预料之内的客户端，其作用跟服务器证书如出一辙。

但客户端证书仍存在几处问题点。 想获取证书时，用户得自行安装客户端证书。但由于客户端证书是要付费购买的，且每张证书对应到每位用户也就意味着需支付和用户数对等的费用。另外，要让知识层次不同的用户们自行安 装证书，这件事本身也充满了各种挑战。

现状是，安全性极高的认证机构可颁发客户端证书但仅用于特殊用途的业务。比如那些可支撑客户端证书支出费用的业务。例如，银行的网上银行就采用了客户端证书。在登录网银时不仅要求用户确认输入 ID 和密码，还会要求用户的客户端证书，以确认用户是否从特定的终端访问网银。

